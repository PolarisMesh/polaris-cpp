# 性能测试（持续改进中）

本文的提供Polaris CPP SDK性能测试方法及性能数据

[TOC]

## 性能测试方法

测试非首次获取服务性能
```bash
make benchmark/bm_consumer
```

## 性能数据

### 获取单个服务实例性能

在C1机器上执行数据如下：

C1机器配置：Intel(R) Xeon(R) CPU E3-1230 V2 @ 3.30GHz, cache size : 8192 KB, processor count: 8	mem_total: 16G,	eth1: 1000Mb/s speed

复用请求的情况下执行结果：

| 服务数 | 实例数  | 线程数  | 平均延迟  |  QPS       |
|--------|--------|--------|-----------|------------|
| 1      | 1000   | 1      |  0.806 us | 1.23997M/s |
| 1      | 1000   | 2      |  0.568 us | 1.75987M/s |
| 1      | 1000   | 4      |  0.308 us |  3.2422M/s |
| 1      | 1000   | 8      |  0.248 us | 4.03175M/s |

不复用请求的成功情况下执行结果：

| 服务数 | 实例数  | 线程数  | 平均延迟  |  QPS       |
|--------|--------|--------|-----------|------------|
| 1      | 1000   | 1      |   1.25 us |  803.12k/s |
| 1      | 1000   | 2      |  0.823 us | 1.21542M/s |
| 1      | 1000   | 4      |  0.434 us | 2.30184M/s |
| 1      | 1000   | 8      |  0.372 us | 2.68946M/s |
| 10     | 100    | 1      |   1.35 us | 740.594k/s |
| 10     | 100    | 2      |  0.806 us | 1.24064M/s |
| 10     | 100    | 4      |  0.441 us | 2.26614M/s |
| 10     | 100    | 8      |  0.376 us | 2.65862M/s |
| 50     | 100    | 1      |   1.62 us | 617.609k/s |
| 50     | 100    | 2      |  0.913 us | 1094.84k/s |
| 50     | 100    | 4      |  0.487 us | 2.05522M/s |
| 50     | 100    | 8      |  0.413 us | 2.42031M/s |
| 100    | 100    | 1      |   1.81 us | 553.061k/s |
| 100    | 100    | 2      |  0.978 us | 1022.26k/s |
| 100    | 100    | 4      |  0.514 us | 1.94725M/s |
| 100    | 100    | 8      |  0.433 us | 2.30945M/s |
| 10     | 500    | 1      |   1.44 us | 695.706k/s |
| 10     | 500    | 2      |  0.814 us | 1.22789M/s |
| 10     | 500    | 4      |  0.440 us | 2.27331M/s |
| 10     | 500    | 8      |  0.380 us | 2.63421M/s |
| 50     | 500    | 1      |   1.82 us | 548.481k/s |
| 50     | 500    | 2      |   1.01 us | 993.809k/s |
| 50     | 500    | 4      |  0.528 us | 1.89362M/s |
| 50     | 500    | 8      |  0.436 us |  2.2918M/s |
| 100    | 500    | 1      |   2.07 us | 482.548k/s |
| 100    | 500    | 2      |   1.11 us | 903.926k/s |
| 100    | 500    | 4      |  0.617 us | 1.61976M/s |
| 100    | 500    | 8      |  0.471 us | 2.12417M/s |
| 10     | 1000   | 1      |   1.44 us | 694.655k/s |
| 10     | 1000   | 2      |  0.836 us | 1.19681M/s |
| 10     | 1000   | 4      |  0.448 us | 2.23106M/s |
| 10     | 1000   | 8      |  0.383 us | 2.61317M/s |
| 50     | 1000   | 1      |   1.94 us | 514.815k/s |
| 50     | 1000   | 2      |   1.05 us | 949.896k/s |
| 50     | 1000   | 4      |  0.557 us | 1.79639M/s |
| 50     | 1000   | 8      |  0.447 us | 2.23612M/s |
| 100    | 1000   | 1      |   2.13 us | 469.389k/s |
| 100    | 1000   | 2      |   1.14 us | 877.743k/s |
| 100    | 1000   | 4      |  0.606 us | 1.65021M/s |
| 100    | 1000   | 8      |  0.477 us | 2.09487M/s |

执行过程中，服务首次获取结束后，SDK内部线程CPU占用稳定在5%以下。
